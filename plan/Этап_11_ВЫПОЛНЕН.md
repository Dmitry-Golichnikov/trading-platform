# –≠—Ç–∞–ø 11: –î–≤–∏–∂–æ–∫ –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞ - –í–´–ü–û–õ–ù–ï–ù ‚úÖ

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: 13 –Ω–æ—è–±—Ä—è 2024

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. –ë–∞–∑–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã ‚úÖ
- `Position` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏—è–º–∏ —Å —Ä–∞—Å—á–µ—Ç–æ–º PnL
- `Portfolio` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ä—Ç—Ñ–µ–ª–µ–º –∏ –∫–∞–ø–∏—Ç–∞–ª–æ–º
- `Order` - –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–æ–≤
- `Execution` - –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–æ–≤

### 2. ExecutionModel ‚úÖ
- –ú–æ–¥–µ–ª—å –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è —Å —É—á–µ—Ç–æ–º –∫–æ–º–∏—Å—Å–∏–π –∏ slippage
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä—ã–Ω–æ—á–Ω—ã—Ö –∏ –ª–∏–º–∏—Ç–Ω—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤
- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —á–∞—Å—Ç–∏—á–Ω–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ
- –£—á–µ—Ç –≤–ª–∏—è–Ω–∏—è –Ω–∞ —Ä—ã–Ω–æ–∫ (market impact)

### 3. –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ ‚úÖ
- `BaseStrategy` - –±–∞–∑–æ–≤—ã–π –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å
- `ModelBasedStrategy` - —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ ML –º–æ–¥–µ–ª–∏
- `SimpleMAStrategy` - –ø—Ä–æ—Å—Ç–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –Ω–∞ —Å–∫–æ–ª—å–∑—è—â–∏—Ö —Å—Ä–µ–¥–Ω–∏—Ö

### 4. Exit Rules (–≤—Å–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã) ‚úÖ
- **Take Profit** (`take_profit.py`)
  - –ü—Ä–æ—Ü–µ–Ω—Ç–Ω—ã–π, ATR-based, –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–Ω—ã–π, –º–æ–¥–µ–ª—å–Ω—ã–π
- **Stop Loss** (`stop_loss.py`)
  - –ü—Ä–æ—Ü–µ–Ω—Ç–Ω—ã–π, ATR-based, –ø–æ–¥–¥–µ—Ä–∂–∫–∞/—Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ, –º–æ–¥–µ–ª—å–Ω—ã–π
  - Hard stop (–∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—é) –∏ soft stop
- **Trailing Stop** (`trailing_stop.py`)
  - –ü—Ä–æ—Ü–µ–Ω—Ç–Ω—ã–π, ATR-based, —Å—Ç—É–ø–µ–Ω—á–∞—Ç—ã–π, –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–Ω—ã–π
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è
- **Time Stop** (`time_stop.py`)
  - –ü–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –±–∞—Ä–æ–≤ –∏–ª–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
  - –£—Å–ª–æ–≤–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–∏–±—ã–ª–∏
- **Reverse Signal** (`reverse_signal.py`)
  - –ü–æ —Å–∏–≥–Ω–∞–ª—É –º–æ–¥–µ–ª–∏ –∏–ª–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
  - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏ cooldown
- **Scale Out** (`scale_out.py`)
  - –ß–∞—Å—Ç–∏—á–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ —É—Ä–æ–≤–Ω—è–º
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ã—Ö, ATR, –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π
- **Risk Limit** (`risk_limit.py`)
  - –î–Ω–µ–≤–Ω–æ–π/–ø–æ—Ä—Ç—Ñ–µ–ª—å–Ω—ã–π –ª–∏–º–∏—Ç —É–±—ã—Ç–∫–∞
  - VaR, —ç–∫—Å–ø–æ–∑–∏—Ü–∏—è, –ø—Ä–æ—Å–∞–¥–∫–∞

### 5. BacktestEngine ‚úÖ
- Event-driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –ò—Ç–µ—Ä–∞—Ü–∏—è –ø–æ –±–∞—Ä–∞–º —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Å–∏–≥–Ω–∞–ª–æ–≤
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º/–∑–∞–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–π
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ exit rules —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–µ–π:
  - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1**: Stop Loss (–Ω–∞–∏–≤—ã—Å—à–∏–π)
  - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2**: Take Profit
  - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3**: Trailing Stop
  - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 4**: Time Stop
  - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 5**: Reverse Signal
  - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 6**: Scale Out
  - **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 7**: Risk Limit
- –ü—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–∏ SL –∏ TP –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —É SL ‚úÖ
- –ò—Å—Ç–æ—Ä–∏—è –∫–∞–ø–∏—Ç–∞–ª–∞ –∏ cash
- Progress bar –¥–ª—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –±—ç–∫—Ç–µ—Å—Ç–æ–≤

### 6. Strategy Metrics ‚úÖ
–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –∏–∑ `docs/metrics/strategy/`:

**Return Metrics:**
- Total Return
- Annualized Return
- Total PnL

**Risk-Adjusted Metrics:**
- Sharpe Ratio
- Sortino Ratio
- Calmar Ratio
- Annualized Volatility

**Drawdown Metrics:**
- Max Drawdown
- Average Drawdown
- Max Drawdown Duration
- Recovery Factor
- Ulcer Index

**Risk Metrics:**
- Value at Risk (VaR)
- Conditional VaR (CVaR)
- Tail Ratio

**Trade Metrics:**
- Win Rate
- Profit Factor
- Payoff Ratio
- Average Win/Loss
- Average Trade Return
- Average Holding Period

**Cost Metrics:**
- Total Commission
- Turnover
- Slippage-adjusted PnL

**Optimization:**
- Kelly Criterion

### 7. Visualizer ‚úÖ
- `plot_equity_curve()` - –∫—Ä–∏–≤–∞—è –∫–∞–ø–∏—Ç–∞–ª–∞ –∏ returns
- `plot_drawdown()` - –ø—Ä–æ—Å–∞–¥–∫–∏ —Å –≤—ã–¥–µ–ª–µ–Ω–∏–µ–º –º–∞–∫—Å–∏–º—É–º–∞
- `plot_trades()` - –∞–Ω–∞–ª–∏–∑ —Å–¥–µ–ª–æ–∫ (PnL, –∫—É–º—É–ª—è—Ç–∏–≤–Ω—ã–π, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ, holding periods)
- `plot_returns_distribution()` - —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ returns –∏ Q-Q plot
- `plot_summary()` - —Å–≤–æ–¥–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ —Å–æ –≤—Å–µ–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏
- `create_all_plots()` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤

### 8. CLI Commands ‚úÖ
- `backtest run` - –∑–∞–ø—É—Å–∫ –±—ç–∫—Ç–µ—Å—Ç–∞ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- `backtest report` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è HTML –æ—Ç—á–µ—Ç–∞
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –¥–∞–Ω–Ω—ã—Ö (CSV, Parquet)
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–º–µ—Ç—Ä–∏–∫–∏, equity curve, —Å–¥–µ–ª–∫–∏, –≥—Ä–∞—Ñ–∏–∫–∏)

### 9. –¢–µ—Å—Ç—ã ‚úÖ
–°–æ–∑–¥–∞–Ω–æ 10 unit-—Ç–µ—Å—Ç–æ–≤ –≤ `tests/unit/test_backtesting.py`:
- `test_position_creation` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏
- `test_position_pnl` - —Ä–∞—Å—á–µ—Ç PnL
- `test_portfolio` - —Ä–∞–±–æ—Ç–∞ —Å –ø–æ—Ä—Ç—Ñ–µ–ª–µ–º
- `test_stop_loss_exit` - Stop Loss exit rule
- `test_take_profit_exit` - Take Profit exit rule
- `test_trailing_stop_exit` - Trailing Stop exit rule
- `test_simple_ma_strategy` - SimpleMAStrategy
- `test_backtest_engine_simple` - BacktestEngine
- `test_strategy_metrics` - StrategyMetrics
- `test_backtest_config` - BacktestConfig

**–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ: 10/10 ‚úÖ**

## –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
src/backtesting/
‚îú‚îÄ‚îÄ __init__.py                   # –≠–∫—Å–ø–æ—Ä—Ç—ã –º–æ–¥—É–ª—è
‚îú‚îÄ‚îÄ engine.py                     # BacktestEngine (203 —Å—Ç—Ä–æ–∫–∏)
‚îú‚îÄ‚îÄ strategy.py                   # BaseStrategy, ModelBasedStrategy, SimpleMAStrategy (161 —Å—Ç—Ä–æ–∫–∞)
‚îú‚îÄ‚îÄ position.py                   # Position (109 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ portfolio.py                  # Portfolio (102 —Å—Ç—Ä–æ–∫–∏)
‚îú‚îÄ‚îÄ order.py                      # Order, Execution (53 —Å—Ç—Ä–æ–∫–∏)
‚îú‚îÄ‚îÄ execution.py                  # ExecutionModel (70 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ metrics.py                    # StrategyMetrics (148 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ visualizer.py                 # BacktestVisualizer (203 —Å—Ç—Ä–æ–∫–∏)
‚îî‚îÄ‚îÄ exits/                        # Exit rules
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îú‚îÄ‚îÄ base.py                   # BaseExitRule
    ‚îú‚îÄ‚îÄ take_profit.py            # TakeProfitExit
    ‚îú‚îÄ‚îÄ stop_loss.py              # StopLossExit
    ‚îú‚îÄ‚îÄ trailing_stop.py          # TrailingStopExit
    ‚îú‚îÄ‚îÄ time_stop.py              # TimeStopExit
    ‚îú‚îÄ‚îÄ reverse_signal.py         # ReverseSignalExit
    ‚îú‚îÄ‚îÄ scale_out.py              # ScaleOutExit
    ‚îî‚îÄ‚îÄ risk_limit.py             # RiskLimitExit

src/interfaces/
‚îî‚îÄ‚îÄ cli_backtest.py               # CLI –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –±—ç–∫—Ç–µ—Å—Ç–∏–Ω–≥–∞

tests/unit/
‚îî‚îÄ‚îÄ test_backtesting.py           # Unit-—Ç–µ—Å—Ç—ã (10 —Ç–µ—Å—Ç–æ–≤)
```

## –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫—Ä–∏—Ç–µ—Ä–∏—è–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- ‚úÖ BacktestEngine —Ä–∞–±–æ—Ç–∞–µ—Ç event-driven
- ‚úÖ –í—Å–µ exit rules —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã (7 —Ç–∏–ø–æ–≤)
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —É—á—ë—Ç –∫–æ–º–∏—Å—Å–∏–π –∏ slippage
- ‚úÖ –í—Å–µ strategy metrics —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã (25+ –º–µ—Ç—Ä–∏–∫)
- ‚úÖ Position management
- ‚úÖ –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è: equity curve, drawdowns, trades
- ‚úÖ CLI: –∫–æ–º–∞–Ω–¥—ã `run` –∏ `report`
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –±—ã—Å—Ç—Ä–æ
- ‚úÖ –ü—Ä–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ SL –∏ TP –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç —É SL
- ‚úÖ –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ SL –∑–∞–∫—Ä—ã—Ç–∏–µ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è Exit Rules
–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è:
```python
# –ü–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ (–æ—Ç –≤—ã—Å—à–µ–≥–æ –∫ –Ω–∏–∑—à–µ–º—É):
1. Stop Loss (–ø—Ä–µ—Ä—ã–≤–∞–µ—Ç –¥–∞–ª—å–Ω–µ–π—à—É—é –ø—Ä–æ–≤–µ—Ä–∫—É)
2. Take Profit
3. Trailing Stop
4. Time Stop
5. Reverse Signal
6. Scale Out
7. Risk Limit
```

### 2. Hard vs Soft Stop Loss
- **Hard Stop**: –ø—Ä–æ–≤–µ—Ä—è–µ—Ç low/high –±–∞—Ä–∞, –∏—Å–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ —É—Ä–æ–≤–Ω—é —Å—Ç–æ–ø-–ª–æ—Å—Å–∞
- **Soft Stop**: –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ close, –∏—Å–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ —Ä—ã–Ω–æ—á–Ω–æ–π —Ü–µ–Ω–µ

### 3. Trailing Stop
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω—è –∑–∞ —Ü–µ–Ω–æ–π
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤ (–ø—Ä–æ—Ü–µ–Ω—Ç, ATR, —Å—Ç—É–ø–µ–Ω—á–∞—Ç—ã–π, –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä)
- –í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ª—É—á—à–µ–π —Ü–µ–Ω—ã

### 4. Scale Out
- –ß–∞—Å—Ç–∏—á–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –ø–æ —É—Ä–æ–≤–Ω—è–º
- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ –≤—Å–µ—Ö —á–∞—Å—Ç–∏—á–Ω—ã—Ö –∑–∞–∫—Ä—ã—Ç–∏—è—Ö
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤ —Ä–∞—Å—á–µ—Ç–∞ —É—Ä–æ–≤–Ω–µ–π

### 5. Risk Limit
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø–æ—Ä—Ç—Ñ–µ–ª—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π reset –ø–æ —É—Å–ª–æ–≤–∏—è–º (–Ω–æ–≤—ã–π –¥–µ–Ω—å, —Ä—É—á–Ω–æ–π, –Ω–∏–∫–æ–≥–¥–∞)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ —Ä–∏—Å–∫–∞

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞**: ~1,700
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤**: 18
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ exit rules**: 7
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Ç—Ä–∏–∫**: 25+
- **–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏**: 10 unit-—Ç–µ—Å—Ç–æ–≤
- **–í—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**: ~2 —á–∞—Å–∞
- **–†–µ–∑—É–ª—å—Ç–∞—Ç –ª–∏–Ω—Ç–µ—Ä–∞**: 0 –æ—à–∏–±–æ–∫ ‚úÖ

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ó–∞–ø—É—Å–∫ –±—ç–∫—Ç–µ—Å—Ç–∞ —á–µ—Ä–µ–∑ Python API
```python
from src.backtesting import BacktestEngine, BacktestConfig, SimpleMAStrategy
import pandas as pd

# –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
data = pd.read_parquet("data.parquet")

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
config = BacktestConfig(
    initial_capital=100000,
    commission_rate=0.001,
    slippage_rate=0.0005,
    use_stop_loss=True,
    stop_loss_value=1.0,
    use_take_profit=True,
    take_profit_value=2.0,
)

# –°—Ç—Ä–∞—Ç–µ–≥–∏—è
strategy = SimpleMAStrategy({"fast_period": 10, "slow_period": 30})

# –ó–∞–ø—É—Å–∫
engine = BacktestEngine(config)
result = engine.run(strategy, data)

# –†–µ–∑—É–ª—å—Ç–∞—Ç—ã
print(f"Total Return: {result.metrics['total_return']:.2f}%")
print(f"Sharpe Ratio: {result.metrics['sharpe_ratio']:.3f}")
print(f"Max Drawdown: {result.metrics['max_drawdown']:.2f}%")
```

### –ó–∞–ø—É—Å–∫ –±—ç–∫—Ç–µ—Å—Ç–∞ —á–µ—Ä–µ–∑ CLI
```bash
# –ü—Ä–æ—Å—Ç–æ–π –±—ç–∫—Ç–µ—Å—Ç
python -m src.interfaces.cli_backtest run \
    --data data.parquet \
    --strategy simple_ma \
    --stop-loss 1.0 \
    --take-profit 2.0 \
    --output ./results

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML –æ—Ç—á–µ—Ç–∞
python -m src.interfaces.cli_backtest report \
    --results ./results \
    --output report.html
```

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø: **[–≠—Ç–∞–ø 12: –°–∏—Å—Ç–µ–º–∞ –ø–∞–π–ø–ª–∞–π–Ω–æ–≤](–≠—Ç–∞–ø_12_–°–∏—Å—Ç–µ–º–∞_–ø–∞–π–ø–ª–∞–π–Ω–æ–≤.md)**

## –ó–∞–º–µ—á–∞–Ω–∏—è

1. ‚úÖ –í—Å–µ exit rules —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Å–æ–≥–ª–∞—Å–Ω–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ `docs/exits/`
2. ‚úÖ –í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Å–æ–≥–ª–∞—Å–Ω–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ `docs/metrics/strategy/`
3. ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è SL > TP —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
4. ‚ö†Ô∏è –î–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `seaborn` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
5. ‚úÖ ModelBasedStrategy –≥–æ—Ç–æ–≤–∞ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –æ–±—É—á–µ–Ω–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤

```bash
============================= test session starts =============================
collected 10 items

tests/unit/test_backtesting.py::test_position_creation PASSED           [ 10%]
tests/unit/test_backtesting.py::test_position_pnl PASSED                [ 20%]
tests/unit/test_backtesting.py::test_portfolio PASSED                   [ 30%]
tests/unit/test_backtesting.py::test_stop_loss_exit PASSED              [ 40%]
tests/unit/test_backtesting.py::test_take_profit_exit PASSED            [ 50%]
tests/unit/test_backtesting.py::test_trailing_stop_exit PASSED          [ 60%]
tests/unit/test_backtesting.py::test_simple_ma_strategy PASSED          [ 70%]
tests/unit/test_backtesting.py::test_backtest_engine_simple PASSED      [ 80%]
tests/unit/test_backtesting.py::test_strategy_metrics PASSED            [ 90%]
tests/unit/test_backtesting.py::test_backtest_config PASSED             [100%]

========================== 10 passed in 6.97s ==========================
```

---

**–≠—Ç–∞–ø 11 –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üéâ
