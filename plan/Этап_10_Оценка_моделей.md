# Этап 10: Модуль оценки моделей

## Цель
Реализовать систему оценки моделей: метрики, калибровка, важность признаков, drift detection.

## Зависимости
Этапы 06-09

## Компоненты

### Метрики (docs/metrics/models/)
**Classification:**
- Accuracy, Precision, Recall, F1-score
- ROC-AUC, PR-AUC
- Matthews Correlation Coefficient (MCC)
- Confusion Matrix
- Classification Report

**Regression:**
- MSE, RMSE, MAE, MAPE
- R², Adjusted R²
- Quantile losses

**Calibration:**
- Calibration curves
- Brier score
- Expected Calibration Error (ECE)

**Drift Detection:**
- PSI (Population Stability Index)
- KS test (Kolmogorov-Smirnov)
- Chi-squared test
- Adversarial validation

### Feature Importance
- Tree-based importances (gain, split)
- Permutation importance
- SHAP values
- Partial Dependence Plots (PDP)
- Individual Conditional Expectation (ICE)

### Model Calibration
```python
class ModelCalibrator:
    """Калибровка вероятностей"""

    methods = ['isotonic', 'platt', 'beta']

    def calibrate(self, y_proba, y_true, method='isotonic'):
        """Калибровать модель"""
```

### Evaluation Report
```python
class ModelEvaluationReport:
    """Комплексный отчёт оценки модели"""

    def generate(self, model, X_test, y_test):
        return {
            'metrics': self._compute_metrics(),
            'calibration': self._calibration_analysis(),
            'feature_importance': self._feature_importance(),
            'drift': self._drift_analysis(),
            'visualizations': self._generate_plots()
        }
```

## Критерии готовности

- [ ] Все метрики из docs/metrics/models/ реализованы
- [ ] Calibration работает
- [ ] Feature importance (все методы)
- [ ] Drift detection
- [ ] Evaluation report генерируется (HTML)
- [ ] CLI: `evaluate-model`, `feature-importance`, `calibrate`

## Промпты

```
Реализуй src/evaluation/:
1. metrics.py - все метрики классификации и регрессии
2. calibration.py - ModelCalibrator с методами калибровки
3. feature_importance.py - все методы важности
4. drift_detection.py - PSI, KS test, adversarial validation
5. reports.py - ModelEvaluationReport с визуализациями

Используй спецификации из docs/metrics/models/.
Генерация HTML отчётов с plotly графиками.
```

## Следующий этап
[Этап 11: Движок бэктестинга](Этап_11_Движок_бэктестинга.md)
