# Этап 13: Оркестрация и управление экспериментами

## Цель
Система оркестрации задач, управление экспериментами, интеграция с MLflow.

## Зависимости
Этапы 00-12

## Компоненты

```
src/orchestration/
├── scheduler.py                  # Task scheduler
├── executor.py                   # Task executor
├── experiment_manager.py         # Experiment management
├── mlflow_integration.py         # MLflow wrapper
├── task_queue.py                 # Task queue (Redis/local)
└── monitoring.py                 # Monitoring hooks
```

## Основные классы

### 1. Experiment Manager
```python
class ExperimentManager:
    """Управление экспериментами"""

    def create_experiment(self, config: dict) -> str:
        """Создать эксперимент"""

    def run_experiment(self, experiment_id: str):
        """Запустить эксперимент"""

    def compare_experiments(self, experiment_ids: list):
        """Сравнить эксперименты"""

    def get_best_model(self, metric: str) -> Model:
        """Получить лучшую модель"""
```

### 2. Task Scheduler
```python
class TaskScheduler:
    """Планировщик задач"""

    def schedule_training(self, config: dict, schedule: str):
        """Запланировать обучение"""

    def schedule_backtest(self, model_id: str, schedule: str):
        """Запланировать бэктест"""

    def schedule_pipeline(self, pipeline: str, schedule: str):
        """Запланировать пайплайн"""
```

### 3. MLflow Integration
```python
class MLflowManager:
    """Обёртка над MLflow"""

    def log_experiment(
        self,
        model,
        metrics: dict,
        params: dict,
        artifacts: dict,
        tags: dict
    ):
        """Логировать эксперимент"""

    def load_model(self, run_id: str) -> Model:
        """Загрузить модель"""

    def register_model(self, run_id: str, name: str):
        """Зарегистрировать в Model Registry"""
```

### 4. Monitoring Hooks
```python
class MonitoringHook:
    """Хуки для мониторинга"""

    def on_experiment_start(self, experiment_id):
        """При старте эксперимента"""

    def on_experiment_end(self, experiment_id, result):
        """При завершении"""

    def on_error(self, experiment_id, error):
        """При ошибке"""
```

## Критерии готовности

- [ ] ExperimentManager работает
- [ ] Интеграция с MLflow полная
- [ ] Task scheduling (cron-like)
- [ ] Monitoring hooks
- [ ] CLI: `experiment create/run/compare/status`
- [ ] Web UI для просмотра экспериментов (через MLflow UI)

## Промпты

```
Реализуй src/orchestration/:
1. experiment_manager.py - ExperimentManager
2. mlflow_integration.py - MLflowManager обёртка
3. scheduler.py - TaskScheduler с cron поддержкой
4. monitoring.py - MonitoringHook система

CLI команды в src/interfaces/cli/experiment_commands.py:
- experiment create
- experiment run
- experiment compare
- experiment best
- experiments list

Интеграция с MLflow для:
- Tracking
- Model Registry
- Artifact storage
```

## Следующий этап
[Этап 14: CLI интерфейс](Этап_14_CLI_интерфейс.md)
