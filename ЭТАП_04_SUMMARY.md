# üéâ –≠—Ç–∞–ø 04: –ú–æ–¥—É–ª—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ - –ó–ê–í–ï–†–®–Å–ù

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (25+ —Ñ–∞–π–ª–æ–≤, ~3500 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞)

**–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
1. **FeatureGenerator** - –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
2. **Config Parser** - Pydantic –≤–∞–ª–∏–¥–∞—Ü–∏—è YAML –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
3. **FeatureCache** - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å Parquet + SQLite
4. **Extractors** (5 —Ç–∏–ø–æ–≤) - –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
5. **Transformers** (4 —Ç–∏–ø–∞) - —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
6. **Selectors** (4 –∫–ª–∞—Å—Å–∞, 8+ –º–µ—Ç–æ–¥–æ–≤) - –æ—Ç–±–æ—Ä –ø—Ä–∏–∑–Ω–∞–∫–æ–≤

### üìä –¢–∏–ø—ã –ø—Ä–∏–∑–Ω–∞–∫–æ–≤

#### Extractors:
- ‚úÖ **Price**: returns, log_returns, high_low_ratio, body_size, wicks, etc.
- ‚úÖ **Volume**: volume_change, volume_ma_ratio, money_volume, relative_volume
- ‚úÖ **Calendar**: hour, day_of_week, month, time_since_open, trading_day
- ‚úÖ **Ticker**: label/onehot/target encoding, sector, industry
- ‚úÖ **Higher TF**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ—Å—ç–º–ø–ª–∏–Ω–≥ –∏ alignment

#### Transformers:
- ‚úÖ **Rolling**: mean, std, min, max, skew, kurt (10 —Ñ—É–Ω–∫—Ü–∏–π)
- ‚úÖ **Lags**: –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ –ª–∞–≥–∏ –¥–ª—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
- ‚úÖ **Differences**: diff, pct_change
- ‚úÖ **Ratios**: —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è –º–µ–∂–¥—É –ø—Ä–∏–∑–Ω–∞–∫–∞–º–∏

#### Selectors:
- ‚úÖ **Filter**: variance, correlation, mutual_info, chi2
- ‚úÖ **Wrapper**: RFE, forward selection, backward elimination
- ‚úÖ **Embedded**: tree importance, L1, SHAP
- ‚úÖ **Drift**: PSI, KS test, adversarial validation

### ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–°–æ–∑–¥–∞–Ω—ã 3 –≥–æ—Ç–æ–≤—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
- `configs/features/minimal.yaml` - –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- `configs/features/default.yaml` - —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–∞–±–æ—Ä (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- `configs/features/full.yaml` - –º–∞–∫—Å–∏–º—É–º –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (~100+)

### üñ•Ô∏è CLI –∫–æ–º–∞–Ω–¥—ã

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
python -m src.interfaces.cli features generate -c config.yaml -d SBER_1m

# –°–ø–∏—Å–æ–∫ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
python -m src.interfaces.cli features list

# –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
python -m src.interfaces.cli features clear-cache

# –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥–∞
python -m src.interfaces.cli features validate-config config.yaml
```

### üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–°–æ–∑–¥–∞–Ω–æ 50+ —Ç–µ—Å—Ç–æ–≤:**
- ‚úÖ `test_feature_extractors.py` - unit —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö extractors
- ‚úÖ `test_feature_transformers.py` - unit —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö transformers
- ‚úÖ `test_feature_generator.py` - —Ç–µ—Å—Ç—ã –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –∏ –∫—ç—à–∞
- ‚úÖ `test_feature_pipeline.py` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ NaN –∑–Ω–∞—á–µ–Ω–∏–π
- ‚úÖ –ö–∞—É–∑–∞–ª—å–Ω–æ—Å—Ç—å (no look-ahead)
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 10K –±–∞—Ä–æ–≤ < 10 —Å–µ–∫ ‚ö°
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ (100%)

- [x] FeatureGenerator —Ä–∞–±–æ—Ç–∞–µ—Ç —Å YAML –∫–æ–Ω—Ñ–∏–≥–∞–º–∏
- [x] –í—Å–µ extractors —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
- [x] Rolling, lags, differences —Ä–∞–±–æ—Ç–∞—é—Ç
- [x] Feature selection –º–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- [x] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] Higher timeframe features
- [x] –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
- [x] CLI: generate-features, list-features
- [x] –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 10K –±–∞—Ä–æ–≤ < 10 —Å–µ–∫
- [x] –í—Å–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –∫–∞—É–∑–∞–ª—å–Ω—ã–µ

## üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–°–æ–∑–¥–∞–Ω–∞ –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- ‚úÖ `docs/features/README.md` - —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ `plan/–≠—Ç–∞–ø_04_–í–´–ü–û–õ–ù–ï–ù.md` - –æ—Ç—á–µ—Ç –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
- ‚úÖ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- ‚úÖ API Reference

## üí° –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –ö–∞—É–∑–∞–ª—å–Ω–æ—Å—Ç—å ‚è∞
–í—Å–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ —Å—Ç—Ä–æ–≥–æ –∫–∞—É–∑–∞–ª—å–Ω—ã–µ:
- –õ–∞–≥–∏ —Ç–æ–ª—å–∫–æ —Å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º–∏ –ø–µ—Ä–∏–æ–¥–∞–º–∏
- Rolling –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–æ—à–ª—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- Higher TF —Å forward fill alignment

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å ‚ö°
- –í–µ–∫—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (pandas/numpy)
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å Parquet (–±—ã—Å—Ç—Ä–æ–µ I/O)
- SQLite –∫–∞—Ç–∞–ª–æ–≥ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- **10,000 –±–∞—Ä–æ–≤ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è < 10 —Å–µ–∫—É–Ω–¥**

### –ì–∏–±–∫–æ—Å—Ç—å üîß
- –î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–µ YAML –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–ø—ã
- Pydantic –≤–∞–ª–∏–¥–∞—Ü–∏—è

## üìù –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```python
from src.features import FeatureGenerator

# –ü—Ä–æ—Å—Ç–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
generator = FeatureGenerator("configs/features/default.yaml")
features = generator.generate(ohlc_data, dataset_id="SBER_1m")

# –° feature selection
features = generator.generate(
    data=ohlc_data,
    dataset_id="SBER_1m",
    target=target_series
)

print(f"–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ {features.shape[1]} –ø—Ä–∏–∑–Ω–∞–∫–æ–≤")
```

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–§–∞–π–ª–æ–≤ —Å–æ–∑–¥–∞–Ω–æ**: 25+
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞**: ~3,500
- **–¢–µ—Å—Ç–æ–≤**: 50+
- **–¢–∏–ø–æ–≤ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤**: 10
- **Feature selection –º–µ—Ç–æ–¥–æ–≤**: 8
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π**: 3

## üöÄ –°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø

**–≠—Ç–∞–ø 05: –†–∞–∑–º–µ—Ç–∫–∞ —Ç–∞—Ä–≥–µ—Ç–æ–≤**
- Horizon labeling (fixed/adaptive)
- Triple barrier method
- Regression targets
- –ü–æ—Å—Ç—Ñ–∏–ª—å—Ç—Ä—ã –∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –í–´–ü–û–õ–ù–ï–ù**
**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è**: 03 –Ω–æ—è–±—Ä—è 2025
**–ö–∞—á–µ—Å—Ç–≤–æ**: ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê
